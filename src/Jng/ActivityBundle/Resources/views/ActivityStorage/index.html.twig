{% extends "JngActivityBundle:layout:layout.html.twig" %}

{% block title %}Activity Storage list{% endblock %}
{% block title_section %}
    <h1>Activities Storage List</h1>
    <h2>All activities stored from {{ d1|date('d/m/Y') }} to {{ d2|date('d/m/Y') }}</h2>
{% endblock %}   

{% block content -%}

    <a href="#" class="content-link" id="link_stat">
        <img src="{{ asset('bundles/jngactivity/images/bulb.png') }}" />
    </a>
        
    <div class="pure-g" style="margin:10px">
        <div class="pure-u-1-3">
            <a class="pure-button pure-button-primary" href="{{ path('activitystorage_new') }}">
                Create a new entry
            </a>
        </div>
        <div class="pure-u-1-3">
            <a class="pure-button pure-button-secondary" href="{{ path('activitystorage_newmanually') }}">
                Create a new entry manually
            </a>
        </div>
        <div class="pure-u-1-3" style="text-align:right">
            <a href="{{ path('webcal',{'id':ical}) }}?noCache">
                <img src="{{ asset('bundles/jngactivity/images/ical.gif') }}" />
            </a>
        </div>
    </div>
    

    
    <div class="float-right chart-container pure-g-r" style="display:none" id="chart1-container">
        <!-- CHART -->
        <div class="pure-u-1">Ratio per customer</div>
        <div class="pure-u-1-2" id="chart1" ></div>
        <div class="pure-u-1-2">
            <form class="pure-form pure-form-stacked" style="text-align:right">
                <select id="filter_chart1">
                    <option value="y">by year</option>
                    <option value="m" >by month</option>
                    <option value="d" selected>today</option>
                </select>
            </form>
            <ul data-pie-id="chart1" id="chart1-data" style="text-align:right"></ul>
        </div>
        <!-- CHART -->
    </div>

    <table class="pure-table">
        <thead>
            <tr>
                <th>Customer</th>
                <th>Activity</th>
                <!--<th>Task</th>-->
                <th>Start</th>
                <th>End</th>
                <th>Diff</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
        {% for entity in entities %}
            <tr>
                <td>{{ entity.activity.customer.name }}</td>
                <td>{{ entity.activity.name }}</td>
                <!--<td>{% if entity.task is not null %}{{ entity.task.name }}{% endif %}</td>-->
                <td>{% if entity.start %}{{ entity.start|date('d/m/Y H:i') }}{% endif %}</td>
                <td>{% if entity.end %}{{ entity.end|date('d/m/Y H:i') }}{% endif %}</td>
                <td>{{ entity.start|diffToDate(entity.end) }}</td>
                <td>
                <ul>
                    <li>
                        <a class="pure-button pure-button-secondary"  href="{{ path('activitystorage_edit', { 'id': entity.id })}}">edit</a>
                    </li>    
                    <li>
                        {% if entity.end is null %}
                         
                        <form action="{{ path('activitystorage_stop', { 'id': entity.id }) }}" method="post">
                            <input type="hidden" name="_method" value="PUT" />
                            {{ form_widget(stopForms[entity.id]._token) }}
                            <button type="submit" class="pure-button pure-button-error"  onclick="return confirm('Are you sure to stop ?')">
                                <i class="icon-trash"></i>stop
                            </button>
                        </form>
                        {% endif %}
                    </li>
                    <li>
                        <form action="{{ path('activitystorage_delete', { 'id': entity.id }) }}" method="post">
                            <input type="hidden" name="_method" value="DELETE" />
                            {{ form_widget(deleteForms[entity.id]._token) }}
                            <button type="submit" class="pure-button pure-button-error"  onclick="return confirm('Are you sure to delete ?')">
                                <i class="icon-trash"></i>delete
                            </button>
                        </form>
                    </li>                    
                    
                </ul>
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

    {% endblock %}
 {% block stylesheets %}
    <link rel="stylesheet"  href="{{ asset('bundles/jngactivity/css/box.css') }}" />
    <link rel="stylesheet"  href="{{ asset('bundles/jngactivity/css/pizza.css') }}" />
{% endblock %}   
    
{% block javascripts %}
    <script src="{{ asset('bundles/jngactivity/js/vendor/snap.svg.js') }}"></script>
    <script src="{{ asset('bundles/jngactivity/js/jquery.pizza.js') }}"></script>
    
    
    <script type="text/javascript">
/* <![CDATA[ */

 jQuery(document).ready(function() {

    // Pizza chart ****************************************
    function updateChart(val){
        $("#chart1").fadeOut("slow");
        //$("#chart1").html("");
        $.post("{{ path('activitystorage_updatechart') }}", { type:val })
         .done( function( data ) {
            $("#chart1").html("");
            $( "#chart1-data" ).html(data);
            Pizza.init();
            $("#chart1").fadeIn("slow");
        });
    }
    $("#filter_chart1").change(function(){updateChart($(this).val())});
    updateChart($("#filter_chart1").val());

    $("#link_stat").click(function(){
        if($("#chart1-container").is(":visible") ){
            $("#chart1-container").fadeOut();
            $(this).fadeTo("slow" , 1);
        } else {
            $("#chart1-container").fadeIn();
            $(this).fadeTo("slow" , 0.4);
        }
    })
    $("#link_stat_close").click(function(){
        $("#chart1-container").fadeOut();
    })
    

});   

/* ]]> */
    </script> 
{% endblock %} 